{
  "$schema": "schema-enhanced.json",
  "version": "2.0.0",
  "language": "nl",
  "metadata": {
    "description": "Penitentiaire beginselenwet - Verbeterde NRML expressie",
    "created": "2025-09-07",
    "enhancement": "Demonstratie van voorgestelde NRML uitbreidingen",
    "legal_basis": {
      "law": "Penitentiaire beginselenwet",
      "bwb_id": "BWBR0009709", 
      "article": "2, 3",
      "url": "https://wetten.overheid.nl/BWBR0009709/2024-01-01"
    }
  },
  "facts": {
    "4c72dc9d-78d4-4f0b-a0cd-6037944f26ce": {
      "name": {"nl": "natuurlijk persoon", "en": "natural person"},
      "_source": "objectType",
      "animated": true,
      "items": {
        "b5200359-418f-40db-bdd2-cf9f7f77b4d4": {
          "name": {"nl": "burgerservicenummer", "en": "BSN"},
          "versions": [{"validFrom": "2022", "type": "text"}]
        },
        "c1d2e3f4-5678-90ab-cdef-123456789abc": {
          "name": {"nl": "is gedetineerd", "en": "is detained"},
          "versions": [{"validFrom": "2022", "type": "characteristic"}]
        }
      }
    },
    "ef9e731c-4f81-4905-a902-2a533e1eebc5": {
      "name": {"nl": "detentie-inrichting", "en": "detention facility"},
      "_source": "objectType", 
      "animated": false,
      "items": {
        "48c6ed9c-0911-43d8-b6ef-47d2b406ea35": {
          "name": {"nl": "type inrichting", "en": "facility type"},
          "versions": [{
            "validFrom": "2022",
            "type": "enumeration",
            "values": ["PENITENTIAIRE_INRICHTING", "HUIS_VAN_BEWARING", "INRICHTING_STELSELMATIGE_DADERS"]
          }]
        }
      }
    },
    "detention-relationship": {
      "name": {"nl": "detentie relatie", "en": "detention relationship"},
      "_source": "relationship",
      "cardinality": "many-to-many",
      "roles": {
        "detainee": {
          "name": {"nl": "gedetineerde", "en": "detainee"},
          "target": {"$ref": "#/facts/4c72dc9d-78d4-4f0b-a0cd-6037944f26ce"},
          "required": true
        },
        "facility": {
          "name": {"nl": "inrichting", "en": "facility"},
          "target": {"$ref": "#/facts/ef9e731c-4f81-4905-a902-2a533e1eebc5"},
          "required": true
        }
      },
      "properties": {
        "admission-date": {
          "name": {"nl": "opnamedatum", "en": "admission date"},
          "type": "date"
        },
        "detention-status": {
          "name": {"nl": "detentie status", "en": "detention status"},
          "type": "enumeration",
          "values": ["INGESLOTEN", "TIJDELIJK_AFWEZIG", "VERLOF", "ONTTROKKEN"]
        }
      }
    },
    "parameter-facts": {
      "name": {"nl": "parameters", "en": "parameters"},
      "_source": "parameter",
      "items": {
        "valid-facility-types": {
          "name": {"nl": "GELDIGE INRICHTING TYPES", "en": "VALID FACILITY TYPES"},
          "versions": [{
            "validFrom": "2022",
            "type": "enumeration", 
            "values": ["PENITENTIAIRE_INRICHTING", "HUIS_VAN_BEWARING", "INRICHTING_STELSELMATIGE_DADERS"]
          }]
        },
        "valid-detention-statuses": {
          "name": {"nl": "GELDIGE DETENTIE STATUSES", "en": "VALID DETENTION STATUSES"},
          "versions": [{
            "validFrom": "2022",
            "type": "enumeration",
            "values": ["INGESLOTEN", "TIJDELIJK_AFWEZIG"]
          }]
        }
      }
    },
    "rule-group": {
      "name": {"nl": "Detentiestatus regels", "en": "Detention status rules"},
      "_source": "ruleGroup",
      "items": {
        "comprehensive-detention-rule": {
          "name": {"nl": "Volledige detentiestatus bepaling artikel 2 Pbw", "en": "Complete detention status per article 2"},
          "versions": [{
            "validFrom": "2022",
            "legalReference": "Penitentiaire beginselenwet artikel 2: Een gedetineerde is hij die rechtens van zijn vrijheid is beroofd",
            "target": [{"$ref": "#/facts/4c72dc9d-78d4-4f0b-a0cd-6037944f26ce/items/c1d2e3f4-5678-90ab-cdef-123456789abc"}],
            "condition": {
              "type": "allOf",
              "conditions": [
                {
                  "type": "exists", 
                  "relationship": [
                    {"$ref": "#/facts/detention-relationship"},
                    {"roles": ["detainee", "facility"]}
                  ]
                },
                {
                  "type": "comparison",
                  "left": [{"$ref": "#/facts/ef9e731c-4f81-4905-a902-2a533e1eebc5/items/48c6ed9c-0911-43d8-b6ef-47d2b406ea35"}],
                  "operator": "in",
                  "right": {"parameter": {"$ref": "#/facts/parameter-facts/items/valid-facility-types"}}
                },
                {
                  "type": "comparison",
                  "left": [{"$ref": "#/facts/detention-relationship/properties/detention-status"}],
                  "operator": "in", 
                  "right": {"parameter": {"$ref": "#/facts/parameter-facts/items/valid-detention-statuses"}}
                },
                {
                  "type": "temporal",
                  "temporalType": "during",
                  "timeReference": "evaluation-date",
                  "condition": {
                    "type": "comparison",
                    "left": [{"$ref": "#/facts/detention-relationship/properties/admission-date"}],
                    "operator": "lessThanOrEquals",
                    "right": {"value": "TODAY"}
                  }
                }
              ]
            },
            "value": {"value": true}
          }]
        },
        "temporary-absence-rule": {
          "name": {"nl": "Tijdelijke afwezigheid regel artikel 3 Pbw", "en": "Temporary absence rule article 3"},
          "versions": [{
            "validFrom": "2022",
            "legalReference": "Penitentiaire beginselenwet artikel 3: Tijdelijk afwezigen blijven gedetineerden",
            "target": [{"$ref": "#/facts/4c72dc9d-78d4-4f0b-a0cd-6037944f26ce/items/c1d2e3f4-5678-90ab-cdef-123456789abc"}],
            "condition": {
              "type": "allOf",
              "conditions": [
                {
                  "type": "exists",
                  "relationship": [
                    {"$ref": "#/facts/detention-relationship"},
                    {"roles": ["detainee", "facility"]}
                  ]
                },
                {
                  "type": "comparison",
                  "left": [{"$ref": "#/facts/detention-relationship/properties/detention-status"}], 
                  "operator": "equals",
                  "right": {"value": "TIJDELIJK_AFWEZIG"}
                }
              ]
            },
            "value": {"value": true}
          }]
        },
        "negative-example-rule": {
          "name": {"nl": "Negatief voorbeeld: Niet gedetineerd bij verlof", "en": "Negative example: Not detained when on leave"},
          "versions": [{
            "validFrom": "2022", 
            "target": [{"$ref": "#/facts/4c72dc9d-78d4-4f0b-a0cd-6037944f26ce/items/c1d2e3f4-5678-90ab-cdef-123456789abc"}],
            "condition": {
              "type": "anyOf",
              "conditions": [
                {
                  "type": "notExists",
                  "relationship": [
                    {"$ref": "#/facts/detention-relationship"},
                    {"roles": ["detainee", "facility"]}
                  ]
                },
                {
                  "type": "comparison",
                  "left": [{"$ref": "#/facts/detention-relationship/properties/detention-status"}],
                  "operator": "in",
                  "right": {"values": ["VERLOF", "ONTTROKKEN"]}
                }
              ]
            },
            "value": {"value": false}
          }]
        }
      }
    }
  }
}